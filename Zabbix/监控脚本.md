## 1.收发数据包丢弃 ##

	键值：net.discard[KEY]
	KEY:
		Send_pkg_loss
		Recv_pkg_loss

	脚本：
		~]# cat check_net_dis.sh 
			#!/bin/bash
	
			case $1 in
			    REC_PACKET_LOSS)
			        ping -c 3 -i 0.2 -W 3 127.0.0.1 &> /dev/null   
			        if [ $? -eq 0 ];then
			        	RD=`cat /proc/net/dev | sed -n '3,$p'| awk  'BEGIN {rd=0;}{rd+=$5;} END{print rd}'`
			            echo $RD
			        else
			             echo -1
			        fi
			        ;;
			    SEND_PACKET_LOSS)
			        ping -c 3 -i 0.2 -W 3 127.0.0.1 &> /dev/null
			        if [ $? -eq 0 ];then
			       		SD=`cat /proc/net/dev | sed -n '3,$p'| awk  'BEGIN {sd=0;}{rd+=$12;} END{print sd}'`
			            echo $SD
			        else
			            echo -1
			        fi
			        ;;
			esac

## 2.TCP状态机

	键值：tcp.status[KEY]
	KEY： CLOSED|CLOSING|CLOSEWAIT|SYNRECV|SYNSENT|FINWAIT1|FINWAIT2|LISTEN|ESTAB|LASTACK|TIMEWAIT
		
	脚本：
		~]# cat tcp_conn_status.sh 
		#!/bin/bash
		# this script is used to get tcp and udp connetion status
		# tcp status
		
		METRIC=$1
		TMP_FILE=/tmp/tcp_status.txt
		
		ss -t -a|awk '{S[$1]++} END{for(a in S) print a,S[a]}' > $TMP_FILE       
		
		case $METRIC in
		    CLOSED)
		        output=$(awk '/CLOSED/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    LISTEN)
		        output=$(awk '/LISTEN/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    SYNRECV)
		        output=$(awk '/SYN-RECV/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    SYNSENT)
		        output=$(awk '/SYN-SENT/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    ESTABLISHED)
		        output=$(awk '/ESTAB/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    TIMEWAIT)
		        output=$(awk '/TIME-WAIT/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    CLOSING)
		        output=$(awk '/CLOSING/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    CLOSEWAIT)
		        output=$(awk '/CLOSE-WAIT/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    LASTACK)
		        output=$(awk '/LAST-ACK/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    FINWAIT1)
		        output=$(awk '/FIN-WAIT-1/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    FINWAIT2)
		        output=$(awk '/FIN-WAIT-2/{print $2}' $TMP_FILE)
		        if [ "$output" == "" ];then
		           echo 0
		        else
		           echo $output
		        fi
		        ;;
		    *)
		        echo -e "\e[033mUsage: $0 [CLOSED|CLOSING|CLOSEWAIT|SYNRECV|SYNSENT|FINWAIT1|FINWAIT2|LISTEN|ESTAB|LASTACK|TIMEWAIT]\e[0m"  
		esac

##3.zabbix API实现进程探测

	~]# cat process_name_discover.sh
		#!/bin/bash
		
		echo "{"
		echo "  "\""data"\"":"[""
		
		
		for proc in `cat /app/tomcat/rclocal_start.sh | awk -F "/" '{print $4}' | awk -F "_" '{print $2}'`
		do
		
		        echo "          {"
		
		        name=$proc
		        ip=`ip a | grep en | tail -n 1 | awk '{print $2}' | awk -F "/" '{print $1}'`
		
		
		        echo "                  "\""{#IPP}"\"":"\""$ip"\"","
		        echo "                  "\""{#NAMEE}"\"":"\""$name"\"""
		
		        sleep 0.01
		        echo "          },"
		
		done
		
		        echo "          {"
		        echo "                  "\""{#IPP}"\"":"\""port"\"","
		        echo "                  "\""{#NAAME}"\"":"\""name"\"""
		
		                echo "          }"
		
		echo "  ]"
		echo "}"
